<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<style>
    body {
        margin: 0;
        padding: 0;
    }
    
    .container {
        height: 100vh;
        width: 100vw;
        display: flex;
        flex-direction: column;
    }
    
    .js-paint {
        background-image: url(https://library.kissclipart.com/20180904/zq/kissclipart-picture-frame-clipart-document-dry-erase-boards-in-3a8a6bd08e3dd544.png);
        background-size: 100% 100%;
        background-repeat: no-repeat;
    }
    
    .paint-canvas {
        border: 1px black solid;
        display: block;
        margin: 1rem;
        cursor: url("./Batman\ Pen.cur"), auto;
    }
</style>

<body>
    <div class="container">
        <div class="minibrd">
            <input type="color" class="js-color-picker color-picker" />
            <input type="range" class="js-line-range" min="1" max="72" value="1" />
            <label class="js-range-value">1</label>Px
            <button onclick="clearBtn()">clear</button>
            <button class="rub" onclick="rubberBtn()">rubber</button>
            <canvas id="paint-canvas" class="js-paint paint-canvas" width="1200" height="600"></canvas>
        </div>
    </div>
</body>
<script>
    let board = document.querySelector("#paint-canvas");
    board.width = document.querySelector(".container").offsetWidth - 30;
    board.height = document.querySelector(".container").offsetHeight - 65;
    const paintCanvas = document.querySelector(".js-paint");
    const context = paintCanvas.getContext("2d");
    context.lineCap = "round";
    const colorPicker = document.querySelector(".js-color-picker");

    colorPicker.addEventListener("change", (event) => {
        context.strokeStyle = event.target.value;
    });

    const lineWidthRange = document.querySelector(".js-line-range");
    const lineWidthLabel = document.querySelector(".js-range-value");

    lineWidthRange.addEventListener("input", (event) => {
        const width = event.target.value;
        lineWidthLabel.innerHTML = width;
        context.lineWidth = width;
    });

    let x = 0,
        y = 0;
    let isMouseDown = false;

    const stopDrawing = () => {
        isMouseDown = false;
    };

    const getMousePositionOnCanvas = (event) => {
        const clientX = event.clientX || event.touches[0].clientX;
        const clientY = event.clientY || event.touches[0].clientY;
        const {
            offsetLeft,
            offsetTop
        } = event.target;

        const viewportOffset = event.target.getBoundingClientRect();
        const top = viewportOffset.top;
        const left = viewportOffset.left;

        const canvasX = clientX - left;
        const canvasY = clientY - top;

        return {
            x: canvasX,
            y: canvasY,
        };
    };
    const startDrawing = (event) => {
        isMouseDown = true;
        const pos = getMousePositionOnCanvas(event);
        x = pos.x;
        y = pos.y;
        // [(x, y)] = [event.offsetX, event.offsetY];
    };
    let isRubber = false;
    const drawLine = (event) => {
        event.preventDefault();
        if (!isMouseDown) return;

        const pos = getMousePositionOnCanvas(event);
        if (isRubber) {
            context.clearRect(pos.x, pos.y, 25, 25);
        } else {

            const newX = pos.x;
            const newY = pos.y;

            context.beginPath();
            context.moveTo(x, y);
            context.lineTo(newX, newY);
            context.stroke();
            // //[x, y] = [newX, newY];
            x = newX;
            y = newY;
        }
    };
    const clr = (clearBtn = () => {
        const $canva = document.getElementById("paint-canvas");
        const context = $canva.getContext("2d");
        context.clearRect(0, 0, $canva.width, $canva.height);
    });
    const crt = (rubberBtn = () => {
        isRubber = !isRubber;
        if (isRubber) {
            document.querySelector('.paint-canvas').style.cursor = `url("./Eraser.cur"), auto`;
            document.querySelector('.rub').innerText = 'pen';
        } else {
            document.querySelector('.paint-canvas').style.cursor = `url("./Batman Pen.cur"), auto`;
            document.querySelector('.rub').innerText = 'rubber';
        }
        const $canva = document.getElementById("paint-canvas");
        const context = $canva.getContext("2d");
    })

    paintCanvas.addEventListener("mousedown", startDrawing);
    paintCanvas.addEventListener("mousemove", drawLine);
    paintCanvas.addEventListener("mouseup", stopDrawing);
    paintCanvas.addEventListener("mouseout", stopDrawing);

    paintCanvas.addEventListener("touchstart", startDrawing);
    paintCanvas.addEventListener("touchmove", drawLine);
    paintCanvas.addEventListener("touchend", stopDrawing);
    paintCanvas.addEventListener("touchcancel", stopDrawing);
</script>

</html>